<% content_for :head do %>
  <%= t '.title' %>
<% end %>


<% if @content.errors.any? %>
  <div id="error_explanation" class="alert alert-danger alert-dismissible">
    <%= t 'general.form_error' %>
  </div>
<% end %>

<%= form_for @content do |f| %>
<div class="box box-primary">
<div class="box box-default">

  <%= render 'form' , f: f %>


</div>
</div>




<div class="box box-danger">
<div class="box box-default">
<div class="row col-md-12">
<div class="row col-md-12">
<h4><%= t '.content_people' %></h4>
</div>
</div>
<div class="box-body">
<div class="row">
<%= f.fields_for :content_people do |cp| %>
   <%= render 'content_person_fields', f: cp %>
<% end %>
</div>
<br>
<%= link_to_add_association t('.add_person'), f, :content_people, :class => 'btn btn-primary' %>
</div>

</div>
</div>

<div class="box-footer">
<%= button_save new_content_path,contents_path,f %>
</div>
<% end %>

<% content_for :javascript do %>

$(document).on("cocoon:after-insert",   function(e, inserted_item) {

    //var oi=inserted_item.find('input:hidden:eq(0)').attr("id");
    //console.log("A");
    //console.log(oi);
    //inserted_item.replace('new_content_item','1000000000000000')

    $(function() {
      $("[id^=content_content_people_attributes_]").on("focus", function() {
        $(this).autocomplete({

          source: function( request, response ) {
            $.ajax({
              url: "<%= person_json_path %>",
              dataType: "json",
              method : 'GET',
              data: {
                name: request.term
              },
              success: function( data ) {
                response( data);
              },
              error : function(xhr, status) {
                alert('It happened some error, please try again later...');
                }
            });
          },
          minLength: 3,
          select: function( event, ui ) {

            $(this).val(ui.item.name);

            var idAutoComplete=$(this).attr("id");
            idAutoComplete=idAutoComplete.replace("content_content_people_attributes_","");
            idAutoComplete=idAutoComplete.replace("_person_name","");
            console.log(idAutoComplete);

            $("#content_content_people_attributes_"+idAutoComplete+"_person_id").val(ui.item.id);
            console.log($("#content_content_people_attributes_"+idAutoComplete+"_person_id").val()+"A");
          },
          change: function( event, ui ) {
            if(ui.item){

            }else{
              //caso nao selecione nenhuma linha, limpa tudo


              $(this).val('');
              $("#content_content_people_attributes_"+idAutoComplete+"_person_id").val('');
            }
          }
        });
    });
  });

} )


$(function() {
  $("[id^=content_content_people_attributes_]").on("focus", function() {
    $(this).autocomplete({

      source: function( request, response ) {
        $.ajax({
          url: "<%= person_json_path %>",
          dataType: "json",
          method : 'GET',
          data: {
            name: request.term
          },
          success: function( data ) {
            response( data);
          },
          error : function(xhr, status) {
            alert('It happened some error, please try again later...');
            }
        });
      },
      minLength: 3,
      select: function( event, ui ) {

        $(this).val(ui.item.name);

        var idAutoComplete=$(this).attr("id");
        idAutoComplete=idAutoComplete.replace("content_content_people_attributes_","");
        idAutoComplete=idAutoComplete.replace("_person_name","");
        console.log(idAutoComplete);

        $("#content_content_people_attributes_"+idAutoComplete+"_person_id").val(ui.item.id);
        console.log($("#content_content_people_attributes_"+idAutoComplete+"_person_id").val()+"A");
      },
      change: function( event, ui ) {
        if(ui.item){

        }else{
          //caso nao selecione nenhuma linha, limpa tudo


          $(this).val('');
        }
      }
    });
});
});


<% end %>
